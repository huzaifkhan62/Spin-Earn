<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Lucky Spin & Earn</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adsgram.ai/sdk-v1.js"></script>
    <style>
        :root { --gold: #f1c40f; --dark: #1a1a1a; --card: #2d2d2d; --text: #ffffff; }
        body { background: var(--dark); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; text-align: center; overflow: hidden; }
        
        .header { padding: 20px; background: var(--card); border-bottom: 2px solid var(--gold); }
        .balance-box { font-size: 24px; font-weight: bold; color: var(--gold); margin-top: 10px; }

        /* Wheel Design */
        .wheel-container { position: relative; width: 300px; height: 300px; margin: 40px auto; border: 10px solid var(--gold); border-radius: 50%; box-shadow: 0 0 20px rgba(241, 196, 15, 0.3); }
        #wheel { width: 100%; height: 100%; border-radius: 50%; transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99); background: conic-gradient(#e74c3c 0deg 60deg, #3498db 60deg 120deg, #2ecc71 120deg 180deg, #f1c40f 180deg 240deg, #9b59b6 240deg 300deg, #e67e22 300deg 360deg); }
        .pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 40px; z-index: 10; }

        .spin-btn { background: var(--gold); border: none; padding: 15px 50px; border-radius: 30px; font-size: 20px; font-weight: bold; cursor: pointer; color: #000; margin-top: 30px; box-shadow: 0 5px 15px rgba(241, 196, 15, 0.4); }
        .spin-btn:disabled { background: #555; color: #888; box-shadow: none; }

        .info-text { margin-top: 20px; font-size: 14px; color: #aaa; }
    </style>
</head>
<body>

    <div class="header">
        <div id="u-name">Welcome!</div>
        <div class="balance-box">ðŸ’° <span id="balance">0</span></div>
    </div>

    <div class="wheel-container">
        <img src="https://cdn-icons-png.flaticon.com/512/8215/8215539.png" class="pointer">
        <div id="wheel"></div>
    </div>

    <button class="spin-btn" id="spinBtn" onclick="startSpinFlow()">SPIN NOW</button>
    
    <div class="info-text" id="status">Watch an ad to get 1 Free Spin!</div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // Aapki Block ID: 20692
        const AdController = window.Adsgram.init({ blockId: "20692" });

        let balance = 0;
        let isSpinning = false;
        let currentRotation = 0;

        document.getElementById('u-name').innerText = "Hello, " + (tg.initDataUnsafe?.user?.first_name || "Player");

        // Sync Data
        tg.CloudStorage.getItem('spin_balance', (err, val) => {
            if(!err && val) {
                balance = parseInt(val);
                document.getElementById('balance').innerText = balance;
            }
        });

        function startSpinFlow() {
            if(isSpinning) return;
            
            const btn = document.getElementById('spinBtn');
            btn.disabled = true;
            btn.innerText = "Loading Ad...";

            AdController.show().then(r => {
                if(r.done) spinWheel();
                else resetUI();
            }).catch(() => {
                spinWheel(); // Backup
            });
        }

        function spinWheel() {
            isSpinning = true;
            const wheel = document.getElementById('wheel');
            const randomDegree = Math.floor(Math.random() * 360) + 1800; // 5 full rotations min
            currentRotation += randomDegree;
            
            wheel.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                const actualDegree = currentRotation % 360;
                calculatePrize(actualDegree);
            }, 4000);
        }

        function calculatePrize(deg) {
            let win = 0;
            // Simple logic for prizes based on degrees
            if(deg >= 0 && deg < 60) win = 50;
            else if(deg >= 60 && deg < 120) win = 10;
            else if(deg >= 120 && deg < 180) win = 100;
            else if(deg >= 180 && deg < 240) win = 5;
            else if(deg >= 240 && deg < 300) win = 200;
            else win = 20;

            balance += win;
            document.getElementById('balance').innerText = balance;
            tg.CloudStorage.setItem('spin_balance', balance.toString());
            
            tg.showAlert(`Congratulations! You won ðŸ’° ${win} coins!`);
            resetUI();
            tg.HapticFeedback.notificationOccurred('success');
        }

        function resetUI() {
            isSpinning = false;
            const btn = document.getElementById('spinBtn');
            btn.disabled = false;
            btn.innerText = "SPIN NOW";
        }
    </script>
</body>
</html>
