<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adsgram.ai/sdk-v1.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; padding: 20px; }
        .stats-box { background: #2d2d2d; padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; margin-bottom: 20px; border: 1px solid #444; }
        .coin-text { color: #ffca28; font-size: 1.2rem; font-weight: bold; }
        .farm-card { background: #252525; border-radius: 20px; padding: 30px; border: 2px solid #4caf50; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        img { width: 120px; margin: 20px 0; }
        button { background: linear-gradient(135deg, #4caf50, #2e7d32); color: white; border: none; padding: 15px 35px; border-radius: 50px; font-size: 1.1rem; font-weight: bold; width: 100%; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        button:disabled { background: #444; color: #888; box-shadow: none; }
        #timer { color: #81c784; margin-top: 10px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div class="stats-box">
        <span id="user-name">Farmer</span>
        <div class="coin-text">ðŸ’° <span id="balance">0</span></div>
    </div>

    <div class="farm-card">
        <h3>Banana Plantation</h3>
        <img src="https://cdn-icons-png.flaticon.com/512/2329/2329865.png" alt="Banana">
        <button id="hBtn" onclick="handleHarvest()">HARVEST NOW</button>
        <p id="timer"></p>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // Bot ko full screen karega

        let score = 0;
        let userName = tg.initDataUnsafe?.user?.first_name || "Farmer";
        document.getElementById('user-name').innerText = userName;

        // --- DATA LOAD KARNA ---
        // Jab game khulega, Telegram se puraane coins maangega
        tg.CloudStorage.getItem('user_coins', (err, value) => {
            if (!err && value) {
                score = parseInt(value);
                document.getElementById('balance').innerText = score;
            }
        });

        function handleHarvest() {
            // Yahan baad mein Adsgram ki ID dalenge
            // AdController.show().then...
            
            score += 40;
            document.getElementById('balance').innerText = score;
            
            // --- DATA SAVE KARNA ---
            // Naye coins ko Telegram Cloud mein save karega
            tg.CloudStorage.setItem('user_coins', score.toString());

            startTimer(180); // 3 minute timer
        }

        function startTimer(seconds) {
            const btn = document.getElementById('hBtn');
            const timerMsg = document.getElementById('timer');
            btn.disabled = true;

            let count = seconds;
            const countdown = setInterval(() => {
                count--;
                let m = Math.floor(count / 60);
                let s = count % 60;
                timerMsg.innerText = `Growing... ${m}m ${s}s`;

                if (count <= 0) {
                    clearInterval(countdown);
                    btn.disabled = false;
                    timerMsg.innerText = "Ready to Harvest!";
                }
            }, 1000);
        }
    </script>
</body>
</html>
