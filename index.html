<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Crypto Spin Wheel</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adsgram.ai/sdk-v1.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        :root { --bg: #120522; --glow: #a020f0; --btn: #7b1fa2; --gold: #ffeb3b; }
        body { background: var(--bg); color: white; font-family: 'Orbitron', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; overflow: hidden; }
        
        .header { width: 85%; display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 15px; margin-bottom: 20px; border: 1px solid var(--glow); }
        .balance { color: var(--gold); font-weight: bold; font-size: 1.2rem; }

        .wheel-box { position: relative; width: 300px; height: 300px; margin-bottom: 30px; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 5px solid var(--glow); transition: transform 4s cubic-bezier(0.1, 0.7, 0.1, 1); background: conic-gradient(#e74c3c 0% 16%, #3498db 16% 33%, #2ecc71 33% 50%, #f1c40f 50% 66%, #9b59b6 66% 83%, #e67e22 83% 100%); box-shadow: 0 0 30px var(--glow); }
        
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 35px; z-index: 10; filter: drop-shadow(0 0 5px white); }
        .center-dot { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: #222; border: 3px solid var(--glow); border-radius: 50%; z-index: 5; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }

        .spin-btn { background: var(--btn); color: white; border: none; padding: 15px 45px; border-radius: 50px; font-size: 1.5rem; font-family: 'Orbitron'; font-weight: bold; cursor: pointer; box-shadow: 0 0 20px var(--glow); transition: 0.3s; }
        .spin-btn:active { transform: scale(0.95); }
        .spin-btn:disabled { background: #444; box-shadow: none; opacity: 0.7; }
        
        .status { margin-top: 20px; font-size: 0.9rem; color: #bbb; }
    </style>
</head>
<body>

    <div class="header">
        <div id="u-name">Player</div>
        <div class="balance">ðŸ’° <span id="balance">0</span></div>
    </div>

    <div class="wheel-box">
        <img src="https://cdn-icons-png.flaticon.com/512/8215/8215539.png" class="pointer">
        <div id="wheel"></div>
        <div class="center-dot" id="center-txt">ðŸŽ®</div>
    </div>

    <button class="spin-btn" id="spinBtn" onclick="initSpin()">SPIN NOW</button>
    <p class="status" id="msg">Watch an ad to Spin!</p>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        const AdController = window.Adsgram.init({ blockId: "20692" });

        let score = 0;
        let spinning = false;
        let rotation = 0;

        // Load Initial Data
        const user = tg.initDataUnsafe?.user;
        if(user) {
            document.getElementById('u-name').innerText = user.first_name;
            document.getElementById('center-txt').innerText = user.first_name.charAt(0).toUpperCase();
        }

        tg.CloudStorage.getItem('spin_score', (err, val) => {
            if(!err && val) {
                score = parseInt(val);
                document.getElementById('balance').innerText = score;
            }
        });

        function initSpin() {
            if(spinning) return;
            
            const btn = document.getElementById('spinBtn');
            const msg = document.getElementById('msg');
            
            btn.disabled = true;
            btn.innerText = "LOADING...";
            msg.innerText = "Connecting to Ad Server...";

            AdController.show().then(r => {
                if(r.done) {
                    startRotation();
                } else {
                    msg.innerText = "Ad not finished!";
                    btn.disabled = false;
                    btn.innerText = "SPIN NOW";
                }
            }).catch(() => {
                // Fallback: Agar ad block ho ya na chale toh bhi spin hone do
                startRotation();
            });
        }

        function startRotation() {
            spinning = true;
            const wheel = document.getElementById('wheel');
            const btn = document.getElementById('spinBtn');
            
            btn.innerText = "SPINNING...";
            const extraDeg = Math.floor(Math.random() * 360) + 1800; // 5 full rounds + random
            rotation += extraDeg;
            
            wheel.style.transform = `rotate(${rotation}deg)`;

            setTimeout(() => {
                const finalDeg = rotation % 360;
                let win = 0;
                
                // Simple Prize Logic
                if(finalDeg >= 0 && finalDeg < 60) win = 100;
                else if(finalDeg >= 60 && finalDeg < 120) win = 10;
                else if(finalDeg >= 120 && finalDeg < 180) win = 500;
                else if(finalDeg >= 180 && finalDeg < 240) win = 50;
                else if(finalDeg >= 240 && finalDeg < 300) win = 250;
                else win = 20;

                score += win;
                document.getElementById('balance').innerText = score;
                tg.CloudStorage.setItem('spin_score', score.toString());
                
                tg.showAlert(`ðŸŽ‰ You won ${win} coins!`);
                spinning = false;
                btn.disabled = false;
                btn.innerText = "SPIN NOW";
                document.getElementById('msg').innerText = "Congratulations!";
                tg.HapticFeedback.notificationOccurred('success');
            }, 4100);
        }
    </script>
</body>
</html>
